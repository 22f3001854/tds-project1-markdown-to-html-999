<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Markdown to HTML Converter</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- Highlight.js CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css" />
<style>
  body {
    padding: 2rem;
  }
  #markdown-output {
    border: 1px solid #dee2e6;
    padding: 1rem;
    border-radius: 0.375rem;
    background-color: #fff;
    max-height: 80vh;
    overflow-y: auto;
  }
</style>
</head>
<body>
<h1 class="mb-4 text-center">Markdown to HTML Converter</h1>
<div class="container mb-3">
  <div class="row mb-2">
    <div class="col">
      <label for="inputMarkdown" class="form-label">Input Markdown</label>
      <textarea id="inputMarkdown" class="form-control" rows="10" placeholder="Enter markdown here..."></textarea>
    </div>
  </div>
  <div class="row mb-2">
    <div class="col">
      <button id="convertBtn" class="btn btn-primary">Convert</button>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <h2>Rendered HTML</h2>
      <div id="markdown-output" class="border"></div>
    </div>
  </div>
</div>

<!-- marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Configure marked to use highlight.js
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        } else {
          return hljs.highlightAuto(code).value;
        }
      },
      langPrefix: 'hljs language-'
    });

    const inputTextarea = document.getElementById('inputMarkdown');
    const outputDiv = document.getElementById('markdown-output');
    const convertButton = document.getElementById('convertBtn');

    function renderMarkdown(markdownText) {
      const html = marked.parse(markdownText);
      outputDiv.innerHTML = html;
      // After rendering, highlight all code blocks
      outputDiv.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightElement(block);
      });
    }

    function fetchAndRenderMarkdown(url) {
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.text();
        })
        .then(md => {
          inputTextarea.value = md;
          renderMarkdown(md);
        })
        .catch(error => {
          outputDiv.innerHTML = `<div class="alert alert-danger" role="alert">Error loading markdown: ${error.message}</div>`;
        });
    }

    // Check for ?url parameter
    const params = new URLSearchParams(window.location.search);
    if (params.has('url')) {
      const url = params.get('url');
      fetchAndRenderMarkdown(url);
    }

    // Convert button click event
    convertButton.addEventListener('click', () => {
      const markdownText = inputTextarea.value;
      renderMarkdown(markdownText);
    });
  });
</script>
</body>
</html>